const animationData = {
  "v": "5.9.0",
  "fr": 16, "ip": 0, "op": 8, "w": 444, "h": 145, "ddd": 0, "assets": [
    {
      "id": "comp_0", "fr": 16, "layers": [
        {
          "ddd": 0, "ind": 1, "ty": 4, "sr": 1,"ks": 
          {"o": {"a": 0, "k": 100, "ix": 11},
            "r": {"a": 0, "k": 0, "ix": 10},
            "p": {"a": 1,"k": [
                {
                  "i": {"x": 0.833, "y": 0.833},
                  "o": {"x": 0.167, "y": 0.167},
                  "t": 0.5,
                  "s": [224.5, 72.5, 0],
                  "to": [0, 0, 0],
                  "ti": [0, 0, 0]
                },
                {"t": 3.5, "s": [226, 72.5, 0]}
              ],
              "ix": 2,
              "l": 2
            },
            "a": {
              "a": 1,
              "k": [
                {
                  "i": {"x": 0.833, "y": 0.833},
                  "o": {"x": 0.167, "y": 0.167},
                  "t": 0.5,
                  "s": [222, 70, 0],
                  "to": [0, 0, 0],
                  "ti": [0, 0, 0]
                },
                {"t": 3.5, "s": [222, 70, 0]}
              ],
              "ix": 1,
              "l": 2
            },
            "s": {"a": 0, "k": [100, 100, 100], "ix": 6, "l": 2}
          },
          "ao": 0,
          "shapes": [
            {
              "ty": "gr",
              "it": [
                {
                  "ind": 0,
                  "ty": "sh",
                  "ix": 1,
                  "ks": {
                    "a": 1,
                    "k": [
                      {
                        "i": {"x": 0.833, "y": 0.833},
                        "o": {"x": 0.167, "y": 0.167},
                        "t": 0.5,
                        "s": [{"i": [[0, 0], [0, 0], [0, 0], [0.882, 2.866]], "o": [[0, 0], [0, 0], [0, 0], [0, 0]], "v": [[34.496, 17.454], [-90.995, 17.7], [-91.096, 36.45], [-184.65, -34.45]], "c": false}]
                      },
                      {
                        "i": {"x": 0.833, "y": 0.833},
                        "o": {"x": 0.167, "y": 0.167},
                        "t": 2,
                        "s": [{"i": [[-0.018, 0.082], [25.358, -2.896], [22.361, -0.034], [1.448, 36.366]], "o": [[-32.081, -0.231], [-16.07, 1.836], [-43.888, 0.067], [0, 0]], "v": [[33.767, 27.209], [-43.431, 32.58], [-103.363, 36.45], [-185.717, -34.45]], "c": false}]
                      },
                      {
                        "t": 3.5,
                        "s": [{"i": [[0.012, -0.007], [14.282, 0.003], [33.672, 0.034], [0, 38.1]], "o": [[-46.738, 0.056], [-19.656, -0.184], [-33.672, -0.034], [0, 0]], "v": [[32.988, 36.297], [-29.094, 36.35], [-114.096, 36.45], [-186.65, -34.45]], "c": false}]
                      }
                    ],
                    "ix": 2
                  },
                },
                {
                  "ty": "st",
                  "c": {"a": 0, "k": [1, 1, 1, 1], "ix": 3},
                  "o": {"a": 0, "k": 100, "ix": 4},
                  "w": {"a": 0, "k": 2, "ix": 5},
                  "lc": 1,
                  "lj": 1,
                  "ml": 10,
                  "bm": 0,
                },
                {
                  "ty": "tr",
                  "p": {"a": 0, "k": [185, 103.584], "ix": 2},
                  "a": {"a": 0, "k": [0, 0], "ix": 1},
                  "s": {"a": 0, "k": [100, 100], "ix": 3},
                  "r": {"a": 0, "k": 0, "ix": 6},
                  "o": {"a": 0, "k": 100, "ix": 7},
                  "sk": {"a": 0, "k": 0, "ix": 4},
                  "sa": {"a": 0, "k": 0, "ix": 5},
                }
              ],
              "np": 2,
              "cix": 2,
              "bm": 0,
              "ix": 2,
            }
          ],
          "ip": 0,
          "op": 11.7333333333333,
          "st": 0,
          "bm": 0
        }
      ]
    }
  ],
  "layers": [
    {
      "ddd": 0,
      "ind": 1,
      "ty": 0,
      "refId": "comp_0",
      "sr": 1,
      "ks": {
        "o": {"a": 0, "k": 100, "ix": 11},
        "r": {"a": 0, "k": 0, "ix": 10},
        "p": {"a": 0, "k": [222, 72.5, 0], "ix": 2, "l": 2},
        "a": {"a": 0, "k": [222, 72.5, 0], "ix": 1, "l": 2},
        "s": {"a": 1,"k": [
            {
              "i": {"x": [0.833, 0.833, 0.833], "y": [0.833, 0.833, 0.833]},
              "o": {"x": [0.167, 0.167, 0.167], "y": [0.167, 0.167, 0.167]},
              "t": 0,
              "s": [-100, 100, 100]
            },
            {"t": 4, "s": [-100, 100, 100]}
          ],
          "ix": 6,
          "l": 2
        }
      },
      "ao": 0,
      "w": 444,
      "h": 145,
      "ip": 0,
      "op": 15,
      "st": 0,
      "bm": 0
    },
    {
      "ddd": 0,
      "ind": 2,
      "ty": 0,
      "refId": "comp_0",
      "sr": 1,
      "ks": {
        "o": {"a": 0, "k": 100, "ix": 11},
        "r": {"a": 0, "k": 0, "ix": 10},
        "p": {"a": 0, "k": [222, 72.5, 0], "ix": 2, "l": 2},
        "a": {"a": 0, "k": [222, 72.5, 0], "ix": 1, "l": 2},
        "s": {
          "a": 1,
          "k": [
            {
              "i": {"x": [0.833, 0.833, 0.833], "y": [0.833, 0.833, 0.833]},
              "o": {"x": [0.167, 0.167, 0.167], "y": [0.167, 0.167, 0.167]},
              "t": 0,
              "s": [100, -100, 100]},
              {"t": 4, "s": [100, -100, 100]}],"ix": 6,"l": 2}
      },
      "ao": 0,
      "w": 444,
      "h": 145,
      "ip": 0,
      "op": 15,
      "st": 0,
      "bm": 0
    },
    {
      "ddd": 0,
      "ind": 3,
      "ty": 0,
      "refId": "comp_0",
      "sr": 1,
      "ks": {
        "o": {"a": 0, "k": 100, "ix": 11},
        "r": {"a": 0, "k": 0, "ix": 10},
        "p": {"a": 0, "k": [222, 72.5, 0], "ix": 2, "l": 2},
        "a": {"a": 0, "k": [222, 72.5, 0], "ix": 1, "l": 2},
        "s": {
          "a": 1,
          "k": [
            {
              "i": {"x": [0.833, 0.833, 0.833], "y": [0.833, 0.833, 0.833]},
              "o": {"x": [0.167, 0.167, 0.167], "y": [0.167, 0.167, 0.167]},
              "t": 0,
              "s": [100, 100, 100]
            },
            {"t": 4, "s": [100, 100, 100]}
          ],
          "ix": 6,
          "l": 2
        }
      },
      "ao": 0,
      "w": 444,
      "h": 145,
      "ip": 0,
      "op": 15,
      "st": 0,
      "bm": 0
    },
    {
      "ddd": 0,
      "ind": 4,
      "ty": 0,
      "refId": "comp_0",
      "sr": 1,
      "ks": {
        "o": {"a": 0, "k": 100, "ix": 11},
        "r": {"a": 0, "k": 0, "ix": 10},
        "p": {"a": 0, "k": [222, 72.5, 0], "ix": 2, "l": 2},
        "a": {"a": 0, "k": [222, 72.5, 0], "ix": 1, "l": 2},
        "s": {
          "a": 1,
          "k": [
            {
              "i": {"x": [0.833, 0.833, 0.833], "y": [0.833, 0.833, 0.833]},
              "o": {"x": [0.167, 0.167, 0.167], "y": [0.167, 0.167, 0.167]},
              "t": 0,
              "s": [-100, -100, 100]},
            {"t": 4, "s": [-100, -100, 100]}],"ix": 6,"l": 2}
      },
      "ao": 0,
      "w": 444,
      "h": 145,
      "ip": 0,
      "op": 15,
      "st": 0,
      "bm": 0
    }
  ],
  "markers": [
    {"tm": 11.5, "cm": "1", "dr": 0}
  ]
}


import { setActiveProject, getActiveProject } from './cursorManager.js';

const PR5CursorGuide = {
    selector: '#project5-image-wrapper',
    init: function(transitionDelay = 0.5) { // transitionDelay in seconds
        const wrapper = document.querySelector(this.selector);
        if (!wrapper) {
            return;
        }

        const customCursor = document.createElement('div');
        customCursor.id = 'pr5-custom-cursor';
        customCursor.style.opacity = '0'; // 初期状態で透明に設定
        wrapper.appendChild(customCursor);

        const cursorText = document.createElement('div');
        cursorText.id = 'pr5-cursor-text';
        customCursor.appendChild(cursorText);

        let isDetailView = false;
        let currentText = '';
        

        document.addEventListener('pr5DetailViewActivated', () => {
            isDetailView = true;
            updateCursorForDetailView();
        });

        document.addEventListener('pr5DetailViewDeactivated', () => {
            isDetailView = false;
            customCursor.style.opacity = '1';
            isFirstEnter = true;
            updateCursorForScrollView();
        });

        const style = document.createElement('style');
style.textContent = `
    #pr5-custom-cursor {
        position: absolute;
        width: 380px;
        height: 80px;
        pointer-events: none;
        z-index: 9999;
        will-change: transform, opacity;
        transition: transform 0.4s ease-out, opacity 0.3s ease-out;
        opacity: 1; 
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
    }
    #pr5-cursor-text {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        font-size: 17px;
        color: #FFFFFF;
        text-align: center;
        white-space: nowrap;
        opacity: 1;
        transition: opacity 0.3s ease-out;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
    }
`;
        document.head.appendChild(style);

        let isAnimating = false;
        let isShapeB = false;
        let lastMoveTime = 0;
        let animation;
        let isFirstEnter = true;
        let cursorX = 0;
        let cursorY = 0;
        let rafId = null;


        function initLottieAnimation() {
            if (animation) {
                animation.destroy();
            }
            
            animation = lottie.loadAnimation({
                container: customCursor,
                renderer: 'svg',
                loop: false,
                autoplay: false,
                animationData: animationData
            });

            animation.addEventListener('DOMLoaded', () => {
                const svg = customCursor.querySelector('svg');
                svg.setAttribute('viewBox', '0 0 442.3 143');
                svg.style.width = '100%';
                svg.style.height = '100%';
                svg.style.position = 'absolute';
                svg.style.left = '50%';
                svg.style.top = '50%';
                svg.style.transform = 'translate(-50%, -50%)';

                updateCursorPosition({ clientX: 0, clientY: 0 });
                updateCursorText(0);
            });
        }

        function updateCursorPosition() {
            customCursor.style.transform = `translate3d(${cursorX}px, ${cursorY}px, 0)`;
            rafId = null;
        }

        function smoothUpdateCursorPosition(e) {
            const rect = wrapper.getBoundingClientRect();
            const targetX = e.clientX - rect.left - customCursor.offsetWidth / 2;
            const targetY = e.clientY - rect.top - customCursor.offsetHeight / 2 -3;
            
            cursorX = cursorX + (targetX - cursorX) * 0.2;
            cursorY = cursorY + (targetY - cursorY) * 0.2;
            
            if (!rafId) {
                rafId = requestAnimationFrame(updateCursorPosition);
            }
        }

        function updateCursorText(delay, newText) {
            if (currentText === newText) return;
            
            cursorText.style.opacity = '0';
            setTimeout(() => {
                cursorText.textContent = newText;
                currentText = newText;
                cursorText.style.opacity = '1';
            }, delay * 1000);
        }

        function updateCursorForDetailView() {
            const svg = customCursor.querySelector('svg');
            if (svg) {
                svg.style.opacity = '0';
            }
            customCursor.style.opacity = '0';
            setTimeout(() => {
                updateCursorText(0, '選択画面に戻る');
                customCursor.style.opacity = '1';
            }, transitionDelay * 2000);
        }

        function updateCursorForScrollView() {
            const svg = customCursor.querySelector('svg');
            if (svg) {
                svg.style.opacity = '1';
            }
            updateCursorText(transitionDelay, isShapeB ? '左右にスクロール' : 'クリックで詳細表示');
        }

        function animateToA() {
            if (isShapeB && !isAnimating && !isDetailView) {
                isAnimating = true;
                animation.setDirection(-1);
                animation.playSegments([0, 5], true);
                animation.addEventListener('complete', () => {
                    isAnimating = false;
                    isShapeB = false;
                    updateCursorText(0, 'クリックで詳細表示');
                }, { once: true });
            }
        }

        function animateToB() {
            if (!isShapeB && !isAnimating && !isDetailView) {
                isAnimating = true;
                animation.setDirection(1);
                animation.playSegments([5, 0], true);
                animation.addEventListener('complete', () => {
                    isAnimating = false;
                    isShapeB = true;
                    updateCursorText(0, '左右にスクロール');
                }, { once: true });
            }
        }


        function handleMouseMove(e) {
            if (isFirstEnter) {
                isFirstEnter = false;
                cursorX = e.clientX - wrapper.getBoundingClientRect().left - customCursor.offsetWidth / 2;
                cursorY = e.clientY - wrapper.getBoundingClientRect().top - customCursor.offsetHeight / 2-3;
                updateCursorPosition();
                customCursor.style.transition = 'transform 0.4s ease-out, opacity 0.5s ease-out';
                customCursor.style.opacity = '1';
            } else {
                smoothUpdateCursorPosition(e);
            }
            
            lastMoveTime = Date.now();

            if (!isShapeB && !isDetailView) {
                animateToB();
            }
        }

        function checkIdleState() {
            if (Date.now() - lastMoveTime > 130 && isShapeB && !isDetailView) {
                animateToA();
            }
        }

        wrapper.addEventListener('mouseenter', (e) => {
            setActiveProject('pr5');
            isFirstEnter = true;
            handleMouseMove(e);
        });

        wrapper.addEventListener('mouseleave', () => {
            setActiveProject(null);
            customCursor.style.opacity = '0';
            isFirstEnter = true;
        });

        wrapper.addEventListener('mousemove', (e) => {
            if (getActiveProject() === 'pr5') {
                handleMouseMove(e);
            }
        });

        setInterval(checkIdleState, 900);

        initLottieAnimation();
    }
};

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        PR5CursorGuide.init(0.5); // 0.5秒の遅延を指定
    });
} else {
    PR5CursorGuide.init(0.5); // 0.5秒の遅延を指定
}

export default PR5CursorGuide;